<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dark Web Leak Scanner - Ghost Whistle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
    
    body {
      font-family: 'JetBrains Mono', monospace;
      background: #0a0a0a;
    }

    .glow {
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { box-shadow: 0 0 20px #7c3aed, 0 0 30px #7c3aed, 0 0 40px #7c3aed; }
      to { box-shadow: 0 0 30px #7c3aed, 0 0 40px #7c3aed, 0 0 50px #7c3aed; }
    }

    .scan-line {
      animation: scan 2s linear infinite;
    }

    @keyframes scan {
      0% { top: 0; }
      100% { top: 100%; }
    }

    .breach-card {
      transition: all 0.3s ease;
    }

    .breach-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
    }

    .typing {
      overflow: hidden;
      border-right: 2px solid #7c3aed;
      white-space: nowrap;
      animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
    }

    @keyframes typing {
      from { width: 0 }
      to { width: 100% }
    }

    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: #7c3aed }
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen">
  
  <!-- Header -->
  <div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between">
      <a href="index.html" class="text-purple-400 hover:text-purple-300 transition">
        ‚Üê Back to Home
      </a>
      <h1 class="text-2xl font-bold text-purple-400">[DARK_WEB_SCANNER]</h1>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-12 max-w-4xl">
    
    <!-- Hero Section -->
    <div class="text-center mb-16">
      <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-red-500 via-purple-500 to-pink-500 bg-clip-text text-transparent">
        DARK WEB LEAK SCANNER
      </h1>
      <p class="text-xl text-gray-400 mb-2">
        Check if your data has been exposed in breaches
      </p>
      <p class="text-sm text-gray-500">
        Scanning 12+ billion leaked records from the dark web
      </p>
    </div>

    <!-- Scanner Input -->
    <div class="bg-gradient-to-r from-purple-900/20 to-pink-900/20 border-2 border-purple-500/30 rounded-2xl p-8 mb-8 glow">
      <div class="mb-6">
        <label class="block text-sm font-bold text-purple-400 mb-3 uppercase tracking-wider">
          [ENTER_EMAIL_OR_USERNAME]
        </label>
        <input 
          type="text" 
          id="searchInput"
          placeholder="email@example.com or username"
          class="w-full bg-black/50 border-2 border-purple-500/50 rounded-xl px-6 py-4 text-white placeholder-gray-500 focus:border-purple-400 focus:outline-none transition font-mono"
        />
      </div>

      <button 
        onclick="startScan()"
        id="scanButton"
        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 uppercase tracking-wider"
      >
        [SCAN_DARK_WEB]
      </button>
    </div>

    <!-- Scanning Animation -->
    <div id="scanningSection" class="hidden mb-8">
      <div class="bg-black/50 border-2 border-purple-500/30 rounded-2xl p-8 relative overflow-hidden">
        <div class="scan-line absolute left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-purple-500 to-transparent"></div>
        
        <div class="space-y-4">
          <div class="flex items-center gap-3">
            <div class="w-4 h-4 bg-purple-500 rounded-full animate-pulse"></div>
            <span class="text-purple-400 font-mono" id="scanStatus">Initializing scan...</span>
          </div>
          
          <div class="space-y-2 text-sm text-gray-500 font-mono" id="scanProgress">
            <div>‚Ä¢ Checking HaveIBeenPwned database...</div>
            <div>‚Ä¢ Searching breach compilations...</div>
            <div>‚Ä¢ Scanning dark web paste sites...</div>
            <div>‚Ä¢ Analyzing leak patterns...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden">
      
      <!-- Summary Card -->
      <div id="summaryCard" class="bg-gradient-to-r from-red-900/30 to-orange-900/30 border-2 border-red-500/50 rounded-2xl p-8 mb-8">
        <div class="flex items-start justify-between">
          <div>
            <h2 class="text-3xl font-bold mb-2 text-red-400" id="breachCount">0 BREACHES FOUND</h2>
            <p class="text-gray-400" id="breachSummary">Your data has been exposed</p>
          </div>
          <div class="text-6xl">üö®</div>
        </div>
      </div>

      <!-- Breach Details -->
      <div id="breachList" class="space-y-4 mb-8">
        <!-- Breach cards will be inserted here -->
      </div>

      <!-- Recommendations -->
      <div class="bg-gradient-to-r from-green-900/20 to-emerald-900/20 border-2 border-green-500/30 rounded-2xl p-8">
        <h3 class="text-xl font-bold text-green-400 mb-4 uppercase">[RECOMMENDED_ACTIONS]</h3>
        <div class="space-y-3 text-gray-300">
          <div class="flex items-start gap-3">
            <span class="text-green-400">‚úì</span>
            <span>Change passwords immediately for all affected accounts</span>
          </div>
          <div class="flex items-start gap-3">
            <span class="text-green-400">‚úì</span>
            <span>Enable two-factor authentication (2FA) everywhere</span>
          </div>
          <div class="flex items-start gap-3">
            <span class="text-green-400">‚úì</span>
            <span>Use unique passwords for each service (use a password manager)</span>
          </div>
          <div class="flex items-start gap-3">
            <span class="text-green-400">‚úì</span>
            <span>Monitor your accounts for suspicious activity</span>
          </div>
          <div class="flex items-start gap-3">
            <span class="text-green-400">‚úì</span>
            <span>Consider using Ghost Whistle nodes for enhanced privacy</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Safe Result -->
    <div id="safeSection" class="hidden">
      <div class="bg-gradient-to-r from-green-900/30 to-emerald-900/30 border-2 border-green-500/50 rounded-2xl p-8 text-center">
        <div class="text-6xl mb-4">‚úÖ</div>
        <h2 class="text-3xl font-bold mb-2 text-green-400">NO BREACHES FOUND</h2>
        <p class="text-gray-400 mb-6">Your email/username is not in our database of known breaches</p>
        <p class="text-sm text-gray-500">
          Note: This doesn't guarantee you've never been breached. New leaks are discovered constantly.
          We recommend scanning regularly.
        </p>
      </div>
    </div>

  </div>

  <!-- Footer CTA -->
  <div class="container mx-auto px-4 py-12 max-w-4xl">
    <div class="bg-gradient-to-r from-purple-900/30 to-pink-900/30 border-2 border-purple-500/30 rounded-2xl p-8 text-center">
      <h3 class="text-2xl font-bold mb-4 text-purple-400">Protect Your Privacy</h3>
      <p class="text-gray-400 mb-6">
        Run a Ghost Whistle node to help secure the network and earn rewards
      </p>
      <div class="flex gap-4 justify-center flex-wrap">
        <a 
          href="index.html#ghost-whistle" 
          class="px-6 py-3 bg-purple-600 hover:bg-purple-500 rounded-xl font-bold transition"
        >
          Learn More
        </a>
        <a 
          href="https://github.com/DylanPort/whitelspace/releases/download/v1.01/Ghost.Whistle.Desktop.1.0.0.exe"
          download
          class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 rounded-xl font-bold transition"
        >
          Download Desktop Node
        </a>
      </div>
    </div>
  </div>

  <script>
    let currentSearch = '';

    async function startScan() {
      const input = document.getElementById('searchInput').value.trim();
      
      if (!input) {
        alert('Please enter an email or username');
        return;
      }

      currentSearch = input;

      // Hide previous results
      document.getElementById('resultsSection').classList.add('hidden');
      document.getElementById('safeSection').classList.add('hidden');
      
      // Show scanning animation
      document.getElementById('scanningSection').classList.remove('hidden');
      document.getElementById('scanButton').disabled = true;
      document.getElementById('scanButton').innerHTML = '[SCANNING...]';

      // Animate scan progress
      await animateScanProgress();

      try {
        // Determine if input is email or username
        const isEmail = input.includes('@');
        
        if (isEmail) {
          await scanEmail(input);
        } else {
          await scanUsername(input);
        }
      } catch (error) {
        console.error('Scan error:', error);
        alert('An error occurred during the scan. Please try again.');
      } finally {
        document.getElementById('scanningSection').classList.add('hidden');
        document.getElementById('scanButton').disabled = false;
        document.getElementById('scanButton').innerHTML = '[SCAN_DARK_WEB]';
      }
    }

    async function animateScanProgress() {
      const statuses = [
        'Connecting to breach databases...',
        'Querying HaveIBeenPwned API...',
        'Searching compiled breach lists...',
        'Checking dark web paste sites...',
        'Analyzing results...',
        'Finalizing scan...'
      ];

      for (let status of statuses) {
        document.getElementById('scanStatus').textContent = status;
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }

    async function scanEmail(email) {
      try {
        // Call our backend API (uses HaveIBeenPwned)
        const apiUrl = window.location.hostname === 'localhost' 
          ? 'http://localhost:8888/.netlify/functions/check-breach'
          : '/.netlify/functions/check-breach';

        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });

        const data = await response.json();

        if (response.status === 429) {
          alert('‚è≥ Rate limit reached. Please try again in a few moments.');
          return;
        }

        if (!response.ok) {
          throw new Error(data.error || 'API error');
        }

        if (data.safe || data.breachCount === 0) {
          showSafeResult();
          return;
        }

        displayBreaches(data.breaches);

      } catch (error) {
        console.error('API Error:', error);
        alert('‚ö†Ô∏è Error connecting to breach database. Please try again later.\n\nError: ' + error.message);
      }
    }

    async function scanUsername(username) {
      // HaveIBeenPwned only supports email addresses
      // For username searches, we'd need additional APIs
      alert('‚ö†Ô∏è Username scanning is coming soon!\n\nCurrently, we only support email address searches.\n\nPlease enter an email address (example@domain.com) to check for breaches.');
      
      // Reset UI
      document.getElementById('scanningSection').classList.add('hidden');
    }

    function showSafeResult() {
      document.getElementById('safeSection').classList.remove('hidden');
    }

    function displayBreaches(breaches) {
      document.getElementById('resultsSection').classList.remove('hidden');
      
      // Update summary
      const count = breaches.length;
      document.getElementById('breachCount').textContent = `${count} BREACH${count !== 1 ? 'ES' : ''} FOUND`;
      document.getElementById('breachSummary').textContent = `Your data was exposed in ${count} known breach${count !== 1 ? 'es' : ''}`;

      // Create breach cards
      const breachList = document.getElementById('breachList');
      breachList.innerHTML = '';

      breaches.forEach(breach => {
        const card = createBreachCard(breach);
        breachList.appendChild(card);
      });
    }

    function createBreachCard(breach) {
      const div = document.createElement('div');
      div.className = 'breach-card bg-black/50 border-2 border-red-500/30 rounded-xl p-6';
      
      const severity = getSeverity(breach.DataClasses);
      const severityColor = severity === 'CRITICAL' ? 'red' : severity === 'HIGH' ? 'orange' : 'yellow';

      div.innerHTML = `
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="text-xl font-bold text-white mb-1">${breach.Name}</h3>
            <p class="text-sm text-gray-400">${breach.Domain || 'N/A'}</p>
          </div>
          <span class="px-3 py-1 bg-${severityColor}-500/20 border border-${severityColor}-500/50 text-${severityColor}-400 text-xs font-bold rounded-full uppercase">
            ${severity}
          </span>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
          <div>
            <span class="text-gray-500">Date:</span>
            <span class="text-white ml-2">${new Date(breach.BreachDate).toLocaleDateString()}</span>
          </div>
          <div>
            <span class="text-gray-500">Accounts:</span>
            <span class="text-white ml-2">${breach.PwnCount.toLocaleString()}</span>
          </div>
        </div>

        <div class="mb-4">
          <p class="text-gray-400 text-sm">${breach.Description}</p>
        </div>

        <div>
          <span class="text-gray-500 text-sm font-bold uppercase">Exposed Data:</span>
          <div class="flex flex-wrap gap-2 mt-2">
            ${breach.DataClasses.map(dataClass => `
              <span class="px-2 py-1 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-xs rounded">
                ${dataClass}
              </span>
            `).join('')}
          </div>
        </div>
      `;

      return div;
    }

    function getSeverity(dataClasses) {
      const critical = ['Passwords', 'Credit cards', 'Bank account numbers', 'Social security numbers'];
      const high = ['Email addresses', 'Phone numbers', 'Physical addresses', 'Dates of birth'];
      
      if (dataClasses.some(dc => critical.some(c => dc.toLowerCase().includes(c.toLowerCase())))) {
        return 'CRITICAL';
      }
      if (dataClasses.some(dc => high.some(h => dc.toLowerCase().includes(h.toLowerCase())))) {
        return 'HIGH';
      }
      return 'MEDIUM';
    }


    // Allow Enter key to trigger scan
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        startScan();
      }
    });
  </script>

</body>
</html>

