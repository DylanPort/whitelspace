<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Privacy Tools Lab Pro - Ghost Whistle</title>
  <link rel="icon" type="image/png" href="whistel_logo_top_right_2048.png">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    @keyframes spin-flip-zoom {
      0% { transform: rotate(0deg) rotateY(0deg) scale(1); }
      25% { transform: rotate(90deg) rotateY(180deg) scale(1.15); }
      50% { transform: rotate(180deg) rotateY(360deg) scale(1); }
      75% { transform: rotate(270deg) rotateY(540deg) scale(1.15); }
      100% { transform: rotate(360deg) rotateY(720deg) scale(1); }
    }
    @keyframes progress-slide {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    @keyframes neon-pulse {
      0%, 100% { text-shadow: 0 0 10px rgba(6, 182, 212, 0.8), 0 0 20px rgba(6, 182, 212, 0.5); }
      50% { text-shadow: 0 0 20px rgba(6, 182, 212, 1), 0 0 30px rgba(6, 182, 212, 0.8), 0 0 40px rgba(251, 191, 36, 0.3); }
    }
    body, html {
      background: #000;
      color: #0f0;
      overflow: hidden;
    }
    .scrollbar-thin::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #0a0a0a;
      border-left: 1px solid #1a1a1a;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(6, 182, 212, 0.7), rgba(0, 255, 0, 0.5));
      border-radius: 4px;
      border: 1px solid rgba(0, 255, 0, 0.3);
    }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, rgba(6, 182, 212, 1), rgba(0, 255, 0, 0.8));
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
    }
    /* Hacker dark theme */
    .glass {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 255, 0, 0.2);
    }
    .panel-title {
      font-size: 10px;
      letter-spacing: .15em;
      color: #0f0;
      text-transform: uppercase;
      font-family: 'Courier New', monospace;
    }
    .splitter-dot {
      width:8px;height:8px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(0,255,0,.9), rgba(6,182,212,.6));
      box-shadow:0 0 12px rgba(0,255,0,.6), 0 0 18px rgba(6,182,212,.4);
    }
    .noise::before{
      content:"";position:fixed;inset:0;pointer-events:none;opacity:.08;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
    }
    .hacker-icon {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #0f0;
      text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
    }
    .btn-hacker {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(0, 255, 0, 0.3);
      color: #0f0;
      transition: all 0.2s;
    }
    .btn-hacker:hover:not(:disabled) {
      background: rgba(0, 255, 0, 0.1);
      border-color: #0f0;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
      transform: translateY(-1px);
    }
    .btn-hacker:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .btn-primary-hacker {
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(0, 255, 0, 0.2));
      border: 1px solid #0f0;
      color: #0f0;
      font-weight: bold;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
    }
    .btn-primary-hacker:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.3), rgba(0, 255, 0, 0.3));
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
    }
    /* Custom syntax highlighting for hacker theme */
    .hljs {
      background: #000 !important;
      color: #94a3b8 !important; /* light slate - default text color */
      padding: 0 !important;
    }
    .hljs-keyword, .hljs-selector-tag, .hljs-built_in { color: #06b6d4 !important; font-weight: bold; } /* cyan */
    .hljs-string, .hljs-title, .hljs-section { color: #f59e0b !important; } /* amber */
    .hljs-variable, .hljs-template-variable { color: #8b5cf6 !important; } /* purple */
    .hljs-comment, .hljs-quote { color: #64748b !important; font-style: italic; } /* slate gray */
    .hljs-number, .hljs-literal { color: #ec4899 !important; } /* pink */
    .hljs-function, .hljs-class { color: #3b82f6 !important; font-weight: bold; } /* blue */
    .hljs-attr, .hljs-attribute { color: #06b6d4 !important; } /* cyan */
    .hljs-tag { color: #8b5cf6 !important; } /* purple */
    .hljs-name { color: #f59e0b !important; } /* amber */
    .hljs-operator { color: #ec4899 !important; } /* pink */
    .hljs-punctuation { color: #94a3b8 !important; } /* light slate */
    .hljs-params { color: #f97316 !important; } /* orange */
    .hljs-meta { color: #06b6d4 !important; } /* cyan */
    .hljs-type { color: #3b82f6 !important; } /* blue */
    /* Code editor line numbers */
    .code-editor-container {
      position: relative;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    .line-numbers {
      position: absolute;
      left: 0;
      top: 0;
      width: 50px;
      padding: 16px 8px;
      text-align: right;
      color: #006600;
      user-select: none;
      pointer-events: none;
      border-right: 1px solid #003300;
    }
    .code-content {
      padding-left: 60px;
      white-space: pre;
      overflow-x: auto;
    }
    @keyframes typing-cursor {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    .typing-cursor {
      display: inline-block;
      width: 2px;
      height: 1em;
      background: #0f0;
      animation: typing-cursor 1s infinite;
      margin-left: 2px;
    }
  </style>
</head>
<body class="bg-black">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // =====================================================
    // FILE TREE COMPONENT
    // =====================================================
    function FileTree({ files, activeFile, onFileSelect, onNewFile, onNewFolder }) {
      const [expandedFolders, setExpandedFolders] = useState(new Set(['']));

      const buildTree = (files) => {
        const tree = {};
        files.forEach(file => {
          const parts = file.path.split('/');
          let current = tree;
          parts.forEach((part, idx) => {
            if (idx === parts.length - 1) {
              current[part] = file;
            } else {
              current[part] = current[part] || {};
              current = current[part];
            }
          });
        });
        return tree;
      };

      const toggleFolder = (path) => {
        const newExpanded = new Set(expandedFolders);
        if (newExpanded.has(path)) {
          newExpanded.delete(path);
        } else {
          newExpanded.add(path);
        }
        setExpandedFolders(newExpanded);
      };

      const getFileIcon = (filename) => {
        if (filename.endsWith('.html')) return <span className="hacker-icon">&lt;/&gt;</span>;
        if (filename.endsWith('.js')) return <span className="hacker-icon">JS</span>;
        if (filename.endsWith('.json')) return <span className="hacker-icon">{'{}'}</span>;
        if (filename.endsWith('.md')) return <span className="hacker-icon">MD</span>;
        if (filename.endsWith('.css')) return <span className="hacker-icon">CSS</span>;
        if (filename.endsWith('.env')) return <span className="hacker-icon">ENV</span>;
        return <span className="hacker-icon">*</span>;
      };

      const renderTree = (node, path = '', level = 0) => {
        return Object.entries(node).map(([key, value]) => {
          const isFile = value.path !== undefined;
          const fullPath = path ? `${path}/${key}` : key;
          
          if (isFile) {
            return (
              <div
                key={value.path}
                data-file-path={value.path}
                onClick={() => onFileSelect(value)}
                className={`
                  py-1.5 px-2 text-xs cursor-pointer transition-all flex items-center gap-2 rounded-md
                  ${activeFile?.path === value.path 
                    ? 'bg-black border-l-2 border-green-500 text-green-400' 
                    : 'hover:bg-black text-gray-500 hover:text-green-400'}
                `}
                style={{ paddingLeft: `${(level + 1) * 12 + 8}px` }}
              >
                <span>{getFileIcon(key)}</span>
                <span className="font-mono">{key}</span>
                <span className="ml-auto text-[10px] text-gray-600">{value.size || 0}b</span>
              </div>
            );
          } else {
            const isExpanded = expandedFolders.has(fullPath);
            return (
              <div key={fullPath}>
                <div
                  onClick={() => toggleFolder(fullPath)}
                  className="py-1.5 px-2 text-xs cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-slate-800/50 flex items-center gap-2 rounded-md transition-all"
                  style={{ paddingLeft: `${level * 12 + 8}px` }}
                >
                  <span className="transition-transform hacker-icon" style={{ transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)' }}>â–º</span>
                  <span className="hacker-icon">DIR</span>
                  <span className="font-mono font-semibold">{key}/</span>
                </div>
                {isExpanded && (
                  <div>
                    {renderTree(value, fullPath, level + 1)}
                  </div>
                )}
              </div>
            );
          }
        });
      };

      const tree = buildTree(files);

      return (
        <div className="bg-black border-r border-green-900 overflow-auto h-full flex flex-col">
          <div className="sticky top-0 bg-black px-3 py-2 border-b border-green-900">
            <div className="flex items-center justify-between mb-2">
              <span className="text-xs text-green-500 font-bold tracking-wider hacker-icon">FILES</span>
              <span className="text-[10px] text-gray-600">{files.length} files</span>
            </div>
            <div className="flex items-center gap-1">
              <button 
                onClick={onNewFile}
                className="flex-1 px-2 py-1 text-[10px] rounded bg-slate-800 hover:bg-slate-700 border border-slate-700 text-cyan-400 transition-all flex items-center justify-center gap-1"
                title="New File"
              >
                <span>+</span> File
              </button>
              <button 
                onClick={onNewFolder}
                className="flex-1 px-2 py-1 text-[10px] rounded bg-slate-800 hover:bg-slate-700 border border-slate-700 text-amber-400 transition-all flex items-center justify-center gap-1"
                title="New Folder"
              >
                <span>+</span> Folder
              </button>
            </div>
          </div>

          <div className="p-2 flex-1 overflow-auto">
            {renderTree(tree)}
          </div>
        </div>
      );
    }

    // =====================================================
    // FILE TABS COMPONENT
    // =====================================================
    function FileTabs({ files, activeFile, onFileSelect, onCloseFile }) {
      return (
        <div className="flex gap-1 bg-black px-2 py-1 border-b border-green-900 overflow-x-auto scrollbar-thin">
          {files.map(file => (
            <div
              key={file.path}
              className={`
                group flex items-center gap-2 px-3 py-1.5 text-xs rounded-t transition-all cursor-pointer whitespace-nowrap
                ${activeFile?.path === file.path 
                  ? 'bg-black text-green-400 border-t border-l border-r border-green-700 font-semibold' 
                  : 'text-gray-500 hover:text-green-400 hover:bg-black'}
              `}
              onClick={() => onFileSelect(file)}
            >
              <span className="font-mono">{file.path.split('/').pop()}</span>
              {onCloseFile && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    onCloseFile(file);
                  }}
                  className="opacity-0 group-hover:opacity-100 text-gray-600 hover:text-red-400 transition-all"
                >
                  Ã—
                </button>
              )}
            </div>
          ))}
        </div>
      );
    }

    // =====================================================
    // CODE EDITOR COMPONENT
    // =====================================================
    function CodeEditor({ file, onEdit }) {
      const editorRef = React.useRef(null);
      const [displayContent, setDisplayContent] = React.useState('');

      React.useEffect(() => {
        if (file) {
          setDisplayContent(file.content);
          // Trigger syntax highlighting
          setTimeout(() => {
            if (editorRef.current && window.hljs) {
              editorRef.current.querySelectorAll('pre code').forEach((block) => {
                window.hljs.highlightElement(block);
              });
            }
          }, 0);
        }
      }, [file?.path, file?.content]);

      if (!file) {
        return (
          <div className="flex-1 flex items-center justify-center text-gray-600 bg-black">
            <div className="text-center">
              <div className="text-4xl mb-4 hacker-icon" style={{fontSize: '3rem'}}>[...]</div>
              <div className="text-sm">Select a file to view</div>
            </div>
          </div>
        );
      }

      const getLanguage = (filename) => {
        if (filename.endsWith('.js')) return 'javascript';
        if (filename.endsWith('.html')) return 'html';
        if (filename.endsWith('.css')) return 'css';
        if (filename.endsWith('.json')) return 'json';
        if (filename.endsWith('.md')) return 'markdown';
        if (filename.endsWith('.py')) return 'python';
        return 'plaintext';
      };

      const lineCount = displayContent.split('\n').length;

      return (
        <div className="flex flex-col bg-black h-full w-full absolute inset-0" ref={editorRef}>
          <div className="sticky top-0 bg-black px-4 py-2 border-b border-green-900 flex items-center justify-between z-10 flex-shrink-0">
            <span className="text-xs text-green-500 font-mono hacker-icon">{file.path}</span>
            <span className="text-[10px] text-gray-600">{file.type || 'file'} â€¢ {lineCount} lines</span>
          </div>
          <div className="flex-1 overflow-auto bg-black code-editor-container">
            {/* Line numbers */}
            <div className="line-numbers">
              {Array.from({ length: lineCount }, (_, i) => (
                <div key={i}>{i + 1}</div>
              ))}
            </div>
            {/* Syntax highlighted code */}
            <pre className="code-content m-0 p-4"><code className={`language-${getLanguage(file.path)}`}>{displayContent}</code></pre>
          </div>
        </div>
      );
    }

    // =====================================================
    // LIVE PREVIEW COMPONENT
    // =====================================================
    function LivePreview({ file }) {
      const handleOpenPreview = () => {
        if (!file || !file.path.endsWith('.html')) return;
        const blob = new Blob([file.content], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        window.open(url, '_blank');
      };

      if (!file || !file.path.endsWith('.html')) {
        return (
          <div className="flex items-center justify-center text-gray-600 bg-black">
            <div className="text-center">
              <div className="text-4xl mb-4 hacker-icon" style={{fontSize: '3rem'}}>{'<>'}</div>
              <div className="text-sm text-gray-500">Preview available for HTML files only</div>
            </div>
          </div>
        );
      }

      return (
        <div className="bg-black h-full w-full flex flex-col absolute inset-0">
          <div className="bg-black px-4 py-2 border-b border-green-900 flex items-center justify-between flex-shrink-0">
            <span className="text-xs text-green-500 font-mono hacker-icon">[PREVIEW]</span>
            <button 
              onClick={handleOpenPreview}
              className="px-3 py-1 text-xs btn-hacker rounded flex items-center gap-1"
            >
              <span className="hacker-icon">â§‰</span>
              <span>Open in New Tab</span>
            </button>
          </div>
          <iframe
            srcDoc={file.content}
            title="Preview"
            className="w-full flex-1 border-0"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-downloads allow-modals"
          />
        </div>
      );
    }

    // =====================================================
    // MAIN FULL-STACK LAB COMPONENT
    // =====================================================
    function FullStackPrivacyToolsLab() {
      // State
      const [description, setDescription] = useState('');
      const [category, setCategory] = useState('General');
      const [includeBackend, setIncludeBackend] = useState(true);
      const [creating, setCreating] = useState(false);
      const [progress, setProgress] = useState('');
      const [error, setError] = useState(null);

      // Project state - Initialize with placeholder to show workspace structure from start
      const [files, setFiles] = useState([
        { path: 'README.md', content: '# WHISTLE PRIVACY TOOL WORKSPACE\n\n>> CHAT WITH AI TO DESCRIBE YOUR TOOL\n\n>> CLICK GENERATE TO BUILD\n\n>> FILES WILL APPEAR AS CREATED', type: 'markdown', size: 150 }
      ]);
      const [activeFile, setActiveFile] = useState(null);
      const [projectStructure, setProjectStructure] = useState(null);
      const [openTabs, setOpenTabs] = useState([]);
      // Incremental build flow (Cursor-style)
      const [plannedFiles, setPlannedFiles] = useState([]); // array of file specs to build
      const [currentIndex, setCurrentIndex] = useState(-1); // index into plannedFiles
      const [awaitingApproval, setAwaitingApproval] = useState(false); // waiting for user confirmation
      const [autoContinue, setAutoContinue] = useState(false); // auto-approve remaining files
      // Resizable workspace widths (percentages)
      const [leftWidth, setLeftWidth] = useState(() => Number(localStorage.getItem('lab_leftWidth')) || 22);
      const [centerWidth, setCenterWidth] = useState(() => Number(localStorage.getItem('lab_centerWidth')) || 48);
      const rightWidth = Math.max(100 - leftWidth - centerWidth, 10);
      const workspaceRef = React.useRef(null);
      const [resizing, setResizing] = useState(null); // 'left' | 'right' | null
      const [showConfirmModal, setShowConfirmModal] = useState(false);
      const [showPlan, setShowPlan] = useState(false);
      const [resourceTab, setResourceTab] = useState('files'); // 'files' | 'plan'
      const [showGitHubModal, setShowGitHubModal] = useState(false);
      const [githubConfig, setGithubConfig] = useState({
        token: localStorage.getItem('github_token') || '',
        repoName: '',
        description: '',
        isPrivate: false,
        uploading: false,
        error: null,
        success: null
      });
      const [layoutMode, setLayoutMode] = useState('tabbed'); // 'tabbed' | 'split'
      const [centerTab, setCenterTab] = useState('editor'); // editor | preview
      const [consoleOpen, setConsoleOpen] = useState(false);
      const [showNewFileModal, setShowNewFileModal] = useState(false);
      const [showNewFolderModal, setShowNewFolderModal] = useState(false);
      const [newFileName, setNewFileName] = useState('');
      const [newFolderName, setNewFolderName] = useState('');

      // Chat state
      const [chatMessages, setChatMessages] = useState([
        { role: 'assistant', content: '>> WHISTLE_AI INITIALIZED\n>> PRIVACY TOOL ARCHITECT ONLINE\n\n[CAPABILITIES]\n[+] ENCRYPTION TOOLS (AES-256, RSA, PBKDF2)\n[+] BACKEND APIS (EXPRESS, AUTH)\n[+] CRYPTO MODULES (KEY DERIVATION, SIGNING)\n[+] PRIVACY UTILS (METADATA STRIP, STEGO)\n[+] FULLSTACK INTEGRATION READY\n\n[EXAMPLES]\n> "Build file encryptor with AES-256"\n> "Create password manager with PBKDF2"\n> "Build metadata stripper with EXIF removal"\n> "Make steganography tool for images"\n\n>> AWAITING YOUR COMMAND...' }
      ]);
      const [userInput, setUserInput] = useState('');

      const API_BASE = window.location.hostname === 'localhost'
        ? 'http://localhost:8888/.netlify/functions'
        : '/.netlify/functions';

      // Handle chat
      const handleChat = async () => {
        if (!userInput.trim()) return;

        const newMessages = [...chatMessages, { role: 'user', content: userInput }];
        setChatMessages(newMessages);
        const currentInput = userInput;
        setUserInput('');
        setDescription(newMessages.filter(m => m.role === 'user').map(m => m.content).join('\n'));

        // Check if user is asking to edit a specific file
        const editRequest = currentInput.toLowerCase();
        const isEditRequest = editRequest.includes('edit') || 
                              editRequest.includes('change') || 
                              editRequest.includes('modify') || 
                              editRequest.includes('update') ||
                              editRequest.includes('fix');

        // Build context with current workspace files
        const workspaceContext = files.length > 0 ? {
          files: files.map(f => ({
            path: f.path,
            content: f.content,
            type: f.type,
            size: f.size
          })),
          activeFile: activeFile ? {
            path: activeFile.path,
            content: activeFile.content
          } : null
        } : null;

        // Call real AI chat with workspace context
        try {
          const res = await fetch(`${API_BASE}/chat-with-ai`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: newMessages.map(m => ({ role: m.role, content: m.content })),
              hasPreview: files.length > 0,
              workspaceContext: workspaceContext,
              isEditRequest: isEditRequest
            })
          });

          if (res.ok) {
            const data = await res.json();
            
            // If AI returned file edits, apply them with visual feedback
            if (data.fileEdits && Array.isArray(data.fileEdits)) {
              console.log(`ðŸ“ Applying ${data.fileEdits.length} file edit(s)...`);
              
              data.fileEdits.forEach((edit, idx) => {
                setTimeout(() => {
                  setFiles(prev => {
                    const fileIndex = prev.findIndex(f => f.path === edit.path);
                    if (fileIndex >= 0) {
                      const updated = [...prev];
                      updated[fileIndex] = {
                        ...updated[fileIndex],
                        content: edit.content,
                        size: edit.content.length
                      };
                      console.log(`âœ… Updated ${edit.path}`);
                      
                      // Update active file if it's the one being edited
                      if (activeFile?.path === edit.path) {
                        setActiveFile(updated[fileIndex]);
                      }
                      
                      // Flash the file in the tree (add/remove highlight class)
                      const fileElement = document.querySelector(`[data-file-path="${edit.path}"]`);
                      if (fileElement) {
                        fileElement.classList.add('bg-cyan-500/20');
                        setTimeout(() => fileElement.classList.remove('bg-cyan-500/20'), 1000);
                      }
                      
                      return updated;
                    }
                    return prev;
                  });
                }, idx * 200); // Stagger edits for visual effect
              });
            }

            setChatMessages([...newMessages, {
              role: 'assistant',
              content: data.message || '>> COMMAND ACKNOWLEDGED\n>> READY TO BUILD\n>> CLICK [>] GENERATE TO INITIATE'
            }]);
          } else {
            // Fallback on error
            setChatMessages([...newMessages, {
              role: 'assistant',
              content: '>> UNDERSTOOD\n>> CLICK [>] GENERATE TO BUILD'
            }]);
          }
        } catch (err) {
          console.error('Chat error:', err);
          setChatMessages([...newMessages, {
            role: 'assistant',
            content: '>> ACKNOWLEDGED\n>> CLICK [>] GENERATE TO BUILD'
          }]);
        }
      };

      // Stream text character-by-character
      const streamText = (fullText, updateCallback, speed = 15) => {
        return new Promise((resolve) => {
          let index = 0;
          const interval = setInterval(() => {
            if (index < fullText.length) {
              updateCallback(fullText.substring(0, index + 1));
              index++;
            } else {
              clearInterval(interval);
              resolve();
            }
          }, speed);
        });
      };

      // Generate one file (by index) and append/replace in workspace
      const generateFileAtIndex = async (index, projectPlan) => {
        const fileSpec = plannedFiles[index];
        if (!fileSpec) return false;
        setProgress(`[BUILD] ${fileSpec.path}... (${index + 1}/${plannedFiles.length})`);
        
        // Create placeholder file immediately
        const placeholderFile = {
          path: fileSpec.path,
          content: `// [GENERATING CODE...]\n// AI is writing ${fileSpec.path}\n// Please wait...\n`,
          type: fileSpec.type,
          size: 0
        };
        
        // Add placeholder to workspace
        setFiles(prev => {
          const exists = prev.findIndex(f => f.path === fileSpec.path);
          if (exists >= 0) {
            const copy = [...prev];
            copy[exists] = placeholderFile;
            return copy;
          }
          return [...prev, placeholderFile];
        });

        // Focus the file being generated
        setActiveFile(placeholderFile);
        setOpenTabs(prev => {
          if (!prev.find(f => f.path === fileSpec.path)) {
            return [...prev, placeholderFile];
          }
          return prev;
        });

        try {
          const fileRes = await fetch(`${API_BASE}/generate-single-file`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              fileSpec,
              projectContext: {
                projectName: (projectPlan?.projectName) || 'privacy-tool',
                description: (projectPlan?.description) || description,
                techStack: (projectPlan?.techStack) || ['JavaScript', 'Node.js']
              }
            })
          });
          if (!fileRes.ok) throw new Error(`Failed to generate ${fileSpec.path}`);
          const fileData = await fileRes.json();
          if (!(fileData?.success && fileData?.file)) throw new Error(`Invalid response for ${fileSpec.path}`);

          // Stream the content character-by-character
          await streamText(fileData.file.content, (streamedContent) => {
            const streamedFile = {
              ...fileData.file,
              content: streamedContent
            };
            
            setFiles(prev => {
              const exists = prev.findIndex(f => f.path === fileData.file.path);
              if (exists >= 0) {
                const copy = [...prev];
                copy[exists] = streamedFile;
                return copy;
              }
              return [...prev, streamedFile];
            });

            setActiveFile(streamedFile);
          });

          return true;
        } catch (e) {
          console.error(e);
          setError(e.message);
          return false;
        }
      };

      // Generate project CURSOR-STYLE: Plan structure, then ask per file
      const handleGenerate = async () => {
        if (!description || description.length < 20) {
          setError('Description must be at least 20 characters');
          return;
        }

        setCreating(true);
        setError(null);
        setProgress('ðŸ§  Planning project structure...');
        
        // Ensure workspace is visible (keep placeholder if empty)
        setFiles(prev => (prev.length ? prev : [{ path: 'README.md', content: '# Preparing project...\n\nThe AI will propose a plan, then we\'ll build files step by step.', type: 'markdown', size: 0 }]));
        setActiveFile(null);
        setOpenTabs([]);
        setProjectStructure(null);

        try {
          // STEP 1: Generate project structure (quick, <5 seconds)
          setProgress('ðŸ“‹ AI is planning your project...');
          const structureRes = await fetch(`${API_BASE}/create-fullstack-tool`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              description,
              category,
              includeBackend,
              structureOnly: true // Just get the plan, don't generate files
            })
          });

          if (!structureRes.ok) {
            throw new Error(`Planning failed: ${structureRes.status}`);
          }

          const structureData = await structureRes.json();
          const projectPlan = structureData.tool || structureData;

          setProjectStructure(projectPlan);
          const filesToGenerate = projectPlan.files || [];

          console.log(`ðŸ“‹ Project plan: ${filesToGenerate.length} files to build`);

          // Prepare approval flow
          setPlannedFiles(filesToGenerate);
          setCurrentIndex(0);
          setAwaitingApproval(true);
          setProgress(`ðŸŸ¡ Ready to generate: ${filesToGenerate[0]?.path} (1/${filesToGenerate.length}). Click Approve to continue`);

        } catch (err) {
          console.error('Generation error:', err);
          setError(`âŒ ${err.message}`);
          setProgress('');
          setCreating(false);
        }
      };

      // File operations
      const handleFileSelect = (file) => {
        setActiveFile(file);
        if (!openTabs.find(f => f.path === file.path)) {
          setOpenTabs([...openTabs, file]);
        }
      };

      const handleCloseTab = (file) => {
        const newTabs = openTabs.filter(f => f.path !== file.path);
        setOpenTabs(newTabs);
        if (activeFile?.path === file.path && newTabs.length > 0) {
          setActiveFile(newTabs[0]);
        }
      };

      const handleFileEdit = (path, content) => {
        const updatedFiles = files.map(f =>
          f.path === path ? { ...f, content } : f
        );
        setFiles(updatedFiles);
        if (activeFile?.path === path) {
          setActiveFile({ ...activeFile, content });
        }
      };

      // Download project as ZIP
      // Create new file manually
      const handleCreateFile = () => {
        if (!newFileName.trim()) return;
        
        const filePath = newFileName.trim();
        
        // Check if file already exists
        if (files.find(f => f.path === filePath)) {
          alert('File already exists!');
          return;
        }
        
        // Determine file type from extension
        const ext = filePath.split('.').pop().toLowerCase();
        const typeMap = {
          'js': 'javascript',
          'jsx': 'javascript',
          'ts': 'typescript',
          'tsx': 'typescript',
          'html': 'html',
          'css': 'css',
          'json': 'json',
          'md': 'markdown',
          'py': 'python',
          'rs': 'rust',
          'go': 'go'
        };
        const fileType = typeMap[ext] || 'text';
        
        // Create file with template content
        const templates = {
          'javascript': '// New JavaScript file\n\n',
          'typescript': '// New TypeScript file\n\n',
          'html': '<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Document</title>\n</head>\n<body>\n  \n</body>\n</html>',
          'css': '/* New stylesheet */\n\n',
          'json': '{\n  \n}',
          'markdown': '# New Document\n\n',
          'text': ''
        };
        
        const newFile = {
          path: filePath,
          content: templates[fileType] || '',
          type: fileType,
          size: (templates[fileType] || '').length
        };
        
        setFiles(prev => [...prev, newFile]);
        setActiveFile(newFile);
        setNewFileName('');
        setShowNewFileModal(false);
        
        console.log(`âœ… Created file: ${filePath}`);
      };
      
      // Create new folder (add README.md inside it)
      const handleCreateFolder = () => {
        if (!newFolderName.trim()) return;
        
        let folderPath = newFolderName.trim();
        // Ensure it ends with /
        if (!folderPath.endsWith('/')) folderPath += '/';
        
        // Check if folder already has files
        if (files.find(f => f.path.startsWith(folderPath))) {
          alert('Folder already exists!');
          return;
        }
        
        // Create a .gitkeep file to represent the folder
        const keepFile = {
          path: `${folderPath}.gitkeep`,
          content: '# This file keeps the folder in git\n',
          type: 'text',
          size: 35
        };
        
        setFiles(prev => [...prev, keepFile]);
        setNewFolderName('');
        setShowNewFolderModal(false);
        
        console.log(`âœ… Created folder: ${folderPath}`);
      };

      // Push to GitHub
      const handlePushToGitHub = async () => {
        const { token, repoName, description, isPrivate } = githubConfig;
        
        if (!token) {
          setGithubConfig(prev => ({ ...prev, error: 'GitHub token required' }));
          return;
        }
        
        if (!repoName) {
          setGithubConfig(prev => ({ ...prev, error: 'Repository name required' }));
          return;
        }
        
        if (files.length === 0) {
          setGithubConfig(prev => ({ ...prev, error: 'No files to upload' }));
          return;
        }

        setGithubConfig(prev => ({ ...prev, uploading: true, error: null, success: null }));

        try {
          // 1. Create repository
          const createRepoRes = await fetch('https://api.github.com/user/repos', {
            method: 'POST',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              name: repoName,
              description: description || `Privacy tool created with Ghost Whistle`,
              private: isPrivate,
              auto_init: true
            })
          });

          if (!createRepoRes.ok) {
            const error = await createRepoRes.json();
            throw new Error(error.message || 'Failed to create repository');
          }

          const repo = await createRepoRes.json();
          const repoFullName = repo.full_name;
          const defaultBranch = repo.default_branch || 'main';

          // 2. Get the latest commit SHA
          const refRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/ref/heads/${defaultBranch}`, {
            headers: {
              'Authorization': `token ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });

          if (!refRes.ok) throw new Error('Failed to get ref');
          const refData = await refRes.json();
          const latestCommitSha = refData.object.sha;

          // 3. Get the base tree
          const commitRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/commits/${latestCommitSha}`, {
            headers: {
              'Authorization': `token ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });

          if (!commitRes.ok) throw new Error('Failed to get commit');
          const commitData = await commitRes.json();
          const baseTreeSha = commitData.tree.sha;

          // 4. Create blobs for all files
          const tree = [];
          for (const file of files) {
            const blobRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/blobs`, {
              method: 'POST',
              headers: {
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/vnd.github.v3+json'
              },
              body: JSON.stringify({
                content: file.content,
                encoding: 'utf-8'
              })
            });

            if (!blobRes.ok) throw new Error(`Failed to create blob for ${file.path}`);
            const blob = await blobRes.json();

            tree.push({
              path: file.path,
              mode: '100644',
              type: 'blob',
              sha: blob.sha
            });
          }

          // 5. Create new tree
          const treeRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/trees`, {
            method: 'POST',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              base_tree: baseTreeSha,
              tree: tree
            })
          });

          if (!treeRes.ok) throw new Error('Failed to create tree');
          const treeData = await treeRes.json();

          // 6. Create new commit
          const newCommitRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/commits`, {
            method: 'POST',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              message: `Add privacy tool files\n\nGenerated with Ghost Whistle Privacy Tools Lab Pro`,
              tree: treeData.sha,
              parents: [latestCommitSha]
            })
          });

          if (!newCommitRes.ok) throw new Error('Failed to create commit');
          const newCommit = await newCommitRes.json();

          // 7. Update reference
          const updateRefRes = await fetch(`https://api.github.com/repos/${repoFullName}/git/refs/heads/${defaultBranch}`, {
            method: 'PATCH',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              sha: newCommit.sha
            })
          });

          if (!updateRefRes.ok) throw new Error('Failed to update ref');

          // Success!
          localStorage.setItem('github_token', token);
          setGithubConfig(prev => ({ 
            ...prev, 
            uploading: false, 
            success: `Successfully uploaded to ${repo.html_url}`,
            repoUrl: repo.html_url
          }));

        } catch (error) {
          console.error('GitHub upload error:', error);
          setGithubConfig(prev => ({ 
            ...prev, 
            uploading: false, 
            error: error.message || 'Failed to upload to GitHub' 
          }));
        }
      };

      const handleDownloadZip = async () => {
        if (files.length === 0) return;

        const zip = new JSZip();
        
        files.forEach(file => {
          zip.file(file.path, file.content);
        });

        const blob = await zip.generateAsync({ type: 'blob' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${projectStructure?.projectName || 'privacy-tool'}.zip`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      // Auto-continue effect: when waiting and toggle is on, proceed
      useEffect(() => {
        if (autoContinue && awaitingApproval && plannedFiles.length > 0 && currentIndex >= 0 && currentIndex < plannedFiles.length) {
          (async () => {
            setAwaitingApproval(false);
            const ok = await generateFileAtIndex(currentIndex, projectStructure);
            if (ok) {
              const next = currentIndex + 1;
              if (next < plannedFiles.length) {
                setCurrentIndex(next);
                setAwaitingApproval(true);
                setProgress(`ðŸŸ¡ Ready to generate: ${plannedFiles[next].path} (${next+1}/${plannedFiles.length})`);
              } else {
                setProgress('âœ… Project complete!');
                setCreating(false);
              }
            } else {
              setAwaitingApproval(true);
            }
          })();
        }
      }, [autoContinue, awaitingApproval, currentIndex]);

      // Actions reused by toolbar and modal
      const proceedCurrentFile = async () => {
        if (!(awaitingApproval && plannedFiles[currentIndex])) return;
        setAwaitingApproval(false);
        const ok = await generateFileAtIndex(currentIndex, projectStructure);
        if (ok) {
          const next = currentIndex + 1;
          if (next < plannedFiles.length) {
            setCurrentIndex(next);
            setAwaitingApproval(true);
            setProgress(`ðŸŸ¡ Ready to generate: ${plannedFiles[next].path} (${next+1}/${plannedFiles.length})`);
          } else {
            setProgress('âœ… Project complete!');
            setCreating(false);
          }
        } else {
          setAwaitingApproval(true);
        }
      };

      const regenerateCurrentFile = async () => {
        if (!plannedFiles[currentIndex]) return;
        setAwaitingApproval(false);
        await generateFileAtIndex(currentIndex, projectStructure);
        setAwaitingApproval(true);
      };

      const skipCurrentFile = () => {
        const next = currentIndex + 1;
        if (next < plannedFiles.length) {
          setCurrentIndex(next);
          setProgress(`ðŸŸ¡ Skipped. Ready: ${plannedFiles[next].path} (${next+1}/${plannedFiles.length})`);
        } else {
          setProgress('âœ… Project complete!');
          setCreating(false);
        }
      };

      // Persist widths
      useEffect(() => {
        localStorage.setItem('lab_leftWidth', String(leftWidth));
        localStorage.setItem('lab_centerWidth', String(centerWidth));
      }, [leftWidth, centerWidth]);

      // Show confirm modal when awaiting approval
      useEffect(() => {
        setShowConfirmModal(awaitingApproval);
      }, [awaitingApproval]);

      // Mouse move handlers for resizers
      useEffect(() => {
        const onMove = (e) => {
          if (!resizing || !workspaceRef.current) return;
          const rect = workspaceRef.current.getBoundingClientRect();
          const x = e.clientX - rect.left; // px from left inside workspace
          const pct = (x / rect.width) * 100; // percent across
          const minLeft = 14, maxLeft = 40;
          const minCenter = 26, maxCenter = 70;
          if (resizing === 'left') {
            const newLeft = Math.min(Math.max(pct, minLeft), maxLeft);
            // Keep center the same unless it squashes right too much
            const remaining = 100 - newLeft - centerWidth;
            if (remaining < 14) {
              const adjustCenter = centerWidth - (14 - remaining);
              setCenterWidth(Math.min(Math.max(adjustCenter, minCenter), maxCenter));
            }
            setLeftWidth(newLeft);
          } else if (resizing === 'right') {
            // Right handle sits at left + center
            let newCenter = Math.min(Math.max(pct - leftWidth, minCenter), maxCenter);
            const remaining = 100 - leftWidth - newCenter;
            if (remaining < 14) newCenter = 100 - leftWidth - 14;
            setCenterWidth(newCenter);
          }
        };
        const onUp = () => setResizing(null);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);
        return () => {
          window.removeEventListener('mousemove', onMove);
          window.removeEventListener('mouseup', onUp);
        };
      }, [resizing, leftWidth, centerWidth]);

      return (
        <div className="w-full min-h-screen bg-black noise">
          {/* Header */}
          <div className="border-b border-slate-800 bg-gradient-to-r from-slate-950 via-black to-slate-950 backdrop-blur-xl sticky top-0 z-50 shadow-lg shadow-cyan-500/10">
            <div className="max-w-[1920px] mx-auto px-8 py-3">
              <div className="flex items-center justify-between">
                {/* Logo and Title */}
                <div className="flex items-center gap-4">
                  <div className="relative w-12 h-12">
                    <img 
                      src="whistel_logo_top_right_2048.png" 
                      alt="Whistle Builder"
                      className="w-full h-full object-contain"
                      style={{
                        animation: 'spin-flip-zoom 8s ease-in-out infinite',
                        filter: 'drop-shadow(0 0 12px rgba(6, 182, 212, 0.6)) drop-shadow(0 0 20px rgba(251, 191, 36, 0.3))'
                      }}
                    />
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400">
                      PRIVACY TOOLS LAB PRO
                    </h1>
                    <p className="text-gray-500 text-[10px] font-medium tracking-wider">GHOST WHISTLE</p>
                  </div>
                </div>

                {/* Actions */}
                <div className="flex items-center gap-3">
                  <button 
                    onClick={() => setShowGitHubModal(true)} 
                    disabled={files.length === 0}
                    className="px-6 py-2 rounded-xl bg-gradient-to-b from-slate-800 to-slate-900 hover:from-slate-700 hover:to-slate-800 text-white text-xs font-semibold tracking-wide transition-all duration-200 shadow-xl disabled:opacity-40 disabled:cursor-not-allowed border border-slate-700/50"
                    style={{
                      boxShadow: '0 4px 14px 0 rgba(0,0,0,0.4), inset 0 1px 0 0 rgba(255,255,255,0.05)'
                    }}
                  >
                    Push to GitHub
                  </button>
                  
                  <button 
                    onClick={handleDownloadZip} 
                    disabled={files.length === 0} 
                    className="px-6 py-2 rounded-xl bg-gradient-to-b from-slate-800 to-slate-900 hover:from-slate-700 hover:to-slate-800 text-white text-xs font-semibold tracking-wide transition-all duration-200 shadow-xl disabled:opacity-40 disabled:cursor-not-allowed border border-slate-700/50"
                    style={{
                      boxShadow: '0 4px 14px 0 rgba(0,0,0,0.4), inset 0 1px 0 0 rgba(255,255,255,0.05)'
                    }}
                  >
                    Download ZIP
                  </button>
                  
                  <div className="px-4 py-2 rounded-xl bg-slate-900/90 border border-slate-700/50 text-slate-400 text-xs font-medium tracking-wide">
                    {files.length} files
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Plan Drawer */}
          {showPlan && plannedFiles.length > 0 && (
            <div className="max-w-[1920px] mx-auto px-8">
              <div className="mt-3 mb-1 rounded-xl border border-green-900 bg-black">
                <div className="px-4 py-3 text-xs text-gray-400 flex items-center justify-between">
                  <span className="font-semibold text-green-500 hacker-icon">PROJECT PLAN</span>
                  <span className="text-gray-600">{currentIndex + 1}/{plannedFiles.length} ready</span>
                </div>
                <div className="max-h-48 overflow-auto divide-y divide-green-900">
                  {plannedFiles.map((f, idx)=>{
                    const status = files.find(x=>x.path===f.path) ? 'done' : (idx===currentIndex && awaitingApproval ? 'awaiting' : 'pending');
                    return (
                      <div key={f.path} className="px-4 py-2 text-xs flex items-center gap-3">
                        <span className={`w-2 h-2 rounded-full ${status==='done'?'bg-emerald-400':status==='awaiting'?'bg-amber-400':'bg-slate-600'}`} />
                        <span className="font-mono text-gray-300">{f.path}</span>
                        <span className="ml-auto text-gray-500">{f.type || 'file'}</span>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          )}

          {/* Main Content */}
          <div className="flex" style={{ height: 'calc(100vh - 80px)' }}>
            
            {/* Left: Chat Panel */}
            <div className="w-96 flex-shrink-0 bg-black backdrop-blur-md border-r border-green-900 flex flex-col">
              <div className="flex-shrink-0 px-6 py-4 border-b border-green-900/50 bg-black">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-xl bg-black border-2 border-green-500/50 flex items-center justify-center overflow-hidden p-1">
                    <img 
                      src="whistel_logo_top_right_2048.png" 
                      alt="Whistle AI"
                      className="w-full h-full object-contain"
                      style={{filter: 'drop-shadow(0 0 8px rgba(0, 255, 0, 0.5))'}}
                    />
                  </div>
                  <div>
                    <h3 className="text-sm font-bold text-green-500 hacker-icon">WHISTLE_AI</h3>
                    <p className="text-[10px] text-gray-600 font-mono">FULLSTACK_DEV</p>
                  </div>
                </div>
              </div>

              {/* Chat Messages */}
              <div className="flex-1 overflow-y-auto p-6 space-y-3 scrollbar-thin">
                {chatMessages.map((msg, idx) => (
                  <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-[85%] px-4 py-2.5 ${
                      msg.role === 'user'
                        ? 'bg-black/70 border border-green-700 text-white'
                        : 'bg-black/40 border border-green-900/50 text-white'
                    }`} style={{borderRadius: '4px'}}>
                      <div className="text-sm whitespace-pre-wrap font-mono leading-relaxed">{msg.content}</div>
                    </div>
                  </div>
                ))}

                {creating && (
                  <div className="text-center py-4">
                    <div className="inline-block px-4 py-2 bg-black border border-green-700" style={{borderRadius: '4px'}}>
                      <div className="text-xs text-green-400 font-mono hacker-icon">{progress}</div>
                    </div>
                  </div>
                )}

                {error && (
                  <div className="bg-black border border-red-700 p-3 text-red-400 text-xs font-mono" style={{borderRadius: '4px'}}>
                    <span className="hacker-icon">[ERROR]</span> {error}
                  </div>
                )}
              </div>

              {/* Input */}
              <div className="flex-shrink-0 p-6 border-t border-green-900/50 bg-black space-y-3">
                <div className="flex items-center gap-2 px-3 py-2 bg-black rounded-lg border border-green-900">
                  <input
                    type="checkbox"
                    id="include-backend"
                    checked={includeBackend}
                    onChange={(e) => setIncludeBackend(e.target.checked)}
                    className="w-4 h-4 accent-green-500"
                  />
                  <label htmlFor="include-backend" className="text-xs text-gray-500 cursor-pointer font-mono">
                    Include Backend (APIs, routes, server)
                  </label>
                </div>

                <textarea
                  value={userInput}
                  onChange={(e) => setUserInput(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                      e.preventDefault();
                      handleChat();
                    }
                  }}
                  placeholder=">> ENTER COMMAND: Describe privacy tool..."
                  rows={3}
                  className="w-full px-4 py-3 rounded-xl bg-black border border-green-900 text-green-400 text-sm resize-none focus:border-green-500 focus:outline-none transition-all placeholder-gray-700 font-mono"
                />

                <div className="flex gap-2">
                  <button
                    onClick={handleChat}
                    disabled={!userInput.trim()}
                    className="flex-1 py-2.5 rounded-lg btn-hacker disabled:opacity-30 text-sm font-mono"
                  >
                    <span className="mr-1 hacker-icon">{'>'}</span> SEND
                  </button>
                  <button
                    onClick={handleGenerate}
                    disabled={creating || !description || description.length < 20}
                    className="flex-1 py-2.5 rounded-lg btn-primary-hacker disabled:opacity-30 text-sm font-mono"
                  >
                    {creating ? <><span className="mr-1 hacker-icon">...</span> BUILDING</> : <><span className="mr-1 hacker-icon">{'[>]'}</span> GENERATE</>}
                  </button>
                </div>
              </div>
            </div>

            {/* Right: Code Editor (Resizable 3-panel) */}
            <div className="flex-1 min-w-0" ref={workspaceRef}>
              {files.length > 0 ? (
                <>
                  {/* TABBED layout */}
                  {layoutMode==='tabbed' ? (
                    <div className="flex h-full"  style={{ width: '100%' }}>
                      <div style={{ width: `${leftWidth}%`, minWidth: '220px' }} className="flex-shrink-0 h-full">
                      {/* Resources Panel (Files | Plan) */}
                      <div className="h-full overflow-hidden border-r border-slate-800 bg-slate-950/40">
                        <div className="flex items-center gap-2 px-3 py-2 border-b border-slate-800 bg-slate-900/60">
                          <button onClick={()=>setResourceTab('files')} className={`px-3 py-1.5 rounded text-xs ${resourceTab==='files'?'bg-slate-800 text-cyan-300 border border-slate-700':'text-gray-400 hover:text-gray-200'}`}>Files</button>
                          <button onClick={()=>setResourceTab('plan')} className={`px-3 py-1.5 rounded text-xs ${resourceTab==='plan'?'bg-slate-800 text-amber-300 border border-slate-700':'text-gray-400 hover:text-gray-200'}`}>Plan</button>
                        </div>
                        <div className="h-full overflow-auto">
                          {resourceTab==='files' ? (
                            <FileTree
                              files={files}
                              activeFile={activeFile}
                              onFileSelect={handleFileSelect}
                              onNewFile={() => setShowNewFileModal(true)}
                              onNewFolder={() => setShowNewFolderModal(true)}
                            />
                          ) : (
                            <div className="p-2">
                              {plannedFiles.length===0 && (
                                <div className="text-[11px] text-gray-500 px-2 py-3">Plan will appear here after Generate â†’ Planning</div>
                              )}
                              {plannedFiles.map((f, idx)=>{
                                const done = !!files.find(x=>x.path===f.path);
                                const isCurrent = idx===currentIndex && awaitingApproval;
                                return (
                                  <div key={f.path} className={`px-2 py-1.5 rounded text-xs cursor-default flex items-center gap-2 ${isCurrent?'bg-amber-500/10 border border-amber-500/30': done?'bg-emerald-500/10 border border-emerald-500/20':'hover:bg-slate-800'}`}>
                                    <span className={`w-1.5 h-1.5 rounded-full ${done?'bg-emerald-400':isCurrent?'bg-amber-400':'bg-slate-600'}`} />
                                    <span className="font-mono text-gray-300 truncate">{f.path}</span>
                                    <span className="ml-auto text-gray-500">{f.type||'file'}</span>
                                  </div>
                                );
                              })}
                            </div>
                          )}
                        </div>
                      </div>
                      </div>

                      {/* Canvas (Tabbed) */}
                      <div className="flex-1 flex flex-col overflow-hidden relative min-w-0">
                        {/* Dark overlay */}
                        <div className="pointer-events-none absolute inset-0 bg-black/20" />

                        {/* Approval bar */}
                        {plannedFiles.length > 0 && currentIndex >= 0 && currentIndex < plannedFiles.length && (
                          <div className="flex items-center justify-between px-3 py-2 bg-black border-b border-green-900 relative z-10">
                            <div className="text-xs text-gray-400 truncate">
                              <span className="text-green-400 font-mono hacker-icon">{plannedFiles[currentIndex]?.path}</span>
                              <span className="ml-2 text-gray-500">({currentIndex + 1}/{plannedFiles.length})</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <button onClick={()=>setCenterTab('editor')} className={`px-3 py-1.5 text-xs rounded ${centerTab==='editor'?'bg-black text-green-400 border border-green-700':'text-gray-500 hover:text-green-400'}`}>Editor</button>
                              <button onClick={()=>setCenterTab('preview')} className={`px-3 py-1.5 text-xs rounded ${centerTab==='preview'?'bg-black text-green-400 border border-green-700':'text-gray-500 hover:text-green-400'}`}>Preview</button>
                              <button disabled={!awaitingApproval} onClick={proceedCurrentFile} className="px-3 py-1.5 text-xs rounded btn-primary-hacker disabled:opacity-40">Approve & Generate</button>
                            </div>
                          </div>
                        )}

                        {/* Tab content */}
                        <div className="flex-1 overflow-hidden bg-slate-950/30 relative">
                          {centerTab==='editor' ? (
                            <CodeEditor file={activeFile} onEdit={handleFileEdit} />
                          ) : (
                            <LivePreview file={activeFile} />
                          )}
                        </div>
                      </div>
                    </div>
                  ) : (
                  /* SPLIT layout (original, but skinned) */
                    <div className="grid h-full" style={{ gridTemplateColumns: `${leftWidth}% ${centerWidth}% ${100 - leftWidth - centerWidth}%` }}>
                    {/* Resources Panel (Files | Plan) */}
                    <div className="min-w-[220px] overflow-hidden border-r border-slate-800 bg-slate-950/40">
                      <div className="flex items-center gap-2 px-3 py-2 border-b border-slate-800 bg-slate-900/60">
                        <button onClick={()=>setResourceTab('files')} className={`px-3 py-1.5 rounded text-xs ${resourceTab==='files'?'bg-slate-800 text-cyan-300 border border-slate-700':'text-gray-400 hover:text-gray-200'}`}>Files</button>
                        <button onClick={()=>setResourceTab('plan')} className={`px-3 py-1.5 rounded text-xs ${resourceTab==='plan'?'bg-slate-800 text-amber-300 border border-slate-700':'text-gray-400 hover:text-gray-200'}`}>Plan</button>
                      </div>
                      <div className="h-full overflow-auto">
                        {resourceTab==='files' ? (
                          <FileTree
                            files={files}
                            activeFile={activeFile}
                            onFileSelect={handleFileSelect}
                            onNewFile={() => setShowNewFileModal(true)}
                            onNewFolder={() => setShowNewFolderModal(true)}
                          />
                        ) : (
                          <div className="p-2">
                            {plannedFiles.length===0 && (
                              <div className="text-[11px] text-gray-500 px-2 py-3">Plan will appear here after Generate â†’ Planning</div>
                            )}
                            {plannedFiles.map((f, idx)=>{
                              const done = !!files.find(x=>x.path===f.path);
                              const isCurrent = idx===currentIndex && awaitingApproval;
                              return (
                                <div key={f.path} className={`px-2 py-1.5 rounded text-xs cursor-default flex items-center gap-2 ${isCurrent?'bg-amber-500/10 border border-amber-500/30': done?'bg-emerald-500/10 border border-emerald-500/20':'hover:bg-slate-800'}`}>
                                  <span className={`w-1.5 h-1.5 rounded-full ${done?'bg-emerald-400':isCurrent?'bg-amber-400':'bg-slate-600'}`} />
                                  <span className="font-mono text-gray-300 truncate">{f.path}</span>
                                  <span className="ml-auto text-gray-500">{f.type||'file'}</span>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Editor Column */}
                    <div className="flex flex-col overflow-hidden">
                    {/* Approval bar */}
                    {plannedFiles.length > 0 && currentIndex >= 0 && currentIndex < plannedFiles.length && (
                      <div className="flex items-center justify-between px-3 py-2 bg-slate-900 border-b border-slate-800">
                        <div className="text-xs text-gray-400 truncate">
                          <span className="text-cyan-400 font-mono">{plannedFiles[currentIndex]?.path}</span>
                          <span className="ml-2 text-gray-500">({currentIndex + 1}/{plannedFiles.length})</span>
                          <span className="ml-3">{awaitingApproval ? 'Awaiting approval' : 'Generating...'}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          <label className="flex items-center gap-1 text-[11px] text-gray-400">
                            <input type="checkbox" checked={autoContinue} onChange={(e)=>setAutoContinue(e.target.checked)} />
                            Auto-continue
                          </label>
                          <button disabled={!awaitingApproval} onClick={proceedCurrentFile} className="px-3 py-1.5 text-xs rounded bg-green-600 hover:bg-green-700 text-white disabled:opacity-40">Approve & Generate</button>
                          <button disabled={!awaitingApproval} onClick={regenerateCurrentFile} className="px-3 py-1.5 text-xs rounded bg-slate-800 border border-slate-700 text-gray-300 disabled:opacity-40">Regenerate</button>
                          <button disabled={!awaitingApproval} onClick={skipCurrentFile} className="px-3 py-1.5 text-xs rounded bg-red-600 hover:bg-red-700 text-white disabled:opacity-40">Skip</button>
                        </div>
                      </div>
                    )}
                    {/* Tabs */}
                    <FileTabs
                      files={openTabs}
                      activeFile={activeFile}
                      onFileSelect={handleFileSelect}
                      onCloseTab={handleCloseTab}
                    />

                    {/* Editor Panel */}
                      <div className="flex-1 overflow-hidden">
                        <div className="panel-title px-3 py-2 border-b border-slate-800 bg-slate-900/60">Editor</div>
                        <CodeEditor file={activeFile} onEdit={handleFileEdit} />
                      </div>
                    </div>

                    {/* Preview Column */}
                    <div className="border-l border-slate-800 overflow-hidden">
                      <div className="panel-title px-3 py-2 border-b border-slate-800 bg-slate-900/60 flex items-center gap-2"><span className="hacker-icon">[VIEW]</span></div>
                      <LivePreview file={activeFile} />
                    </div>
                    </div>
                  )}

                  {/* Resizers (only for split layout) */}
                  {layoutMode==='split' && (
                    <>
                      <div onMouseDown={()=>setResizing('left')} className="absolute top-0 bottom-0 flex items-center justify-center" style={{ left: `calc(${leftWidth}% - 6px)`, width: '12px', cursor: 'col-resize' }}>
                        <div className="splitter-dot" />
                      </div>
                      <div onMouseDown={()=>setResizing('right')} className="absolute top-0 bottom-0 flex items-center justify-center" style={{ left: `calc(${leftWidth + centerWidth}% - 6px)`, width: '12px', cursor: 'col-resize' }}>
                        <div className="splitter-dot" />
                      </div>
                    </>
                  )}
                </>
              ) : (
                <div className="flex-1 flex items-center justify-center bg-black">
                  <div className="text-center max-w-2xl px-8">
                    {creating ? (
                      <>
                        <div className="relative w-32 h-32 mx-auto mb-8">
                          <img 
                            src="whistel_logo_top_right_2048.png" 
                            alt="Building..."
                            className="w-full h-full object-contain animate-pulse"
                            style={{
                              animation: 'spin-flip-zoom 2s ease-in-out infinite',
                              filter: 'drop-shadow(0 0 30px rgba(6, 182, 212, 0.6)) drop-shadow(0 0 50px rgba(251, 191, 36, 0.4))'
                            }}
                          />
                        </div>
                        <div className="text-2xl font-bold text-green-500 mb-4 font-mono">
                          <span className="hacker-icon">{progress || '[BUILDING...]'}</span>
                        </div>
                        <div className="text-sm text-gray-500 mb-8 font-mono">
                          {'>> FILES GENERATING IN WORKSPACE...'}
                        </div>
                        {/* Progress bar */}
                        <div className="w-full h-2 bg-black rounded-full overflow-hidden border border-green-900">
                          <div 
                            className="h-full bg-gradient-to-r from-green-500 to-cyan-500 animate-pulse"
                            style={{
                              width: '100%',
                              animation: 'progress-slide 2s ease-in-out infinite'
                            }}
                          />
                        </div>
                      </>
                    ) : (
                      <>
                        <div className="text-6xl mb-4 hacker-icon" style={{fontSize: '4rem', color: '#0f0'}}>{'[...]'}</div>
                        <div className="text-lg mb-2 text-green-500 font-mono hacker-icon">FULLSTACK WORKSPACE</div>
                        <div className="text-sm text-gray-500 mb-6 font-mono">
                          {'>> CHAT WITH AI TO DESIGN TOOL'}
                          <br />
                          {'>> CLICK GENERATE TO BUILD PROJECT'}
                        </div>
                        <div className="inline-flex items-center gap-2 px-4 py-2 bg-black rounded-lg border border-green-900">
                          <span className="text-xs text-green-500 hacker-icon">{'[READY]'}</span>
                        </div>
                      </>
                    )}
                  </div>
                </div>
              )}
            </div>

            {/* Premium Confirmation Modal */}
            {showConfirmModal && plannedFiles[currentIndex] && (
              <div className="fixed inset-0 z-50 flex items-center justify-center">
                <div className="absolute inset-0 bg-black/70 backdrop-blur-sm" onClick={()=>setShowConfirmModal(false)} />
                <div className="relative w-full max-w-xl mx-4 rounded-2xl border border-green-900 bg-black shadow-2xl">
                  <div className="px-6 py-4 border-b border-green-900 flex items-center justify-between">
                    <div className="text-sm font-semibold text-green-500 hacker-icon">APPROVE GENERATION</div>
                    <button onClick={()=>setShowConfirmModal(false)} className="text-gray-400 hover:text-gray-200">âœ•</button>
                  </div>
                  <div className="px-6 py-5 space-y-4">
                    <div className="text-xs text-gray-400">Next file to generate</div>
                    <div className="flex items-center gap-2 text-sm">
                      <span className="px-2 py-1 rounded bg-slate-800 text-cyan-300 border border-slate-700 font-mono">{plannedFiles[currentIndex].path}</span>
                      <span className="text-gray-500">({currentIndex + 1}/{plannedFiles.length})</span>
                    </div>
                    <div className="text-xs text-gray-500">Type: {plannedFiles[currentIndex].type || 'file'} Â· {plannedFiles[currentIndex].description || 'No description provided'}</div>
                    <div className="flex items-center justify-between pt-2">
                      <label className="flex items-center gap-2 text-xs text-gray-400">
                        <input type="checkbox" checked={autoContinue} onChange={(e)=>setAutoContinue(e.target.checked)} />
                        Auto-continue after this file
                      </label>
                      <div className="flex items-center gap-2">
                        <button onClick={skipCurrentFile} className="px-3 py-1.5 text-xs rounded btn-hacker">Skip</button>
                        <button onClick={regenerateCurrentFile} className="px-3 py-1.5 text-xs rounded btn-hacker">Regenerate</button>
                        <button onClick={()=>{ setShowConfirmModal(false); proceedCurrentFile(); }} className="px-4 py-1.5 text-xs rounded btn-primary-hacker">Approve & Generate</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* GitHub Upload Modal */}
            {showGitHubModal && (
              <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                <div className="relative w-full max-w-lg mx-4 rounded-2xl border border-purple-900/50 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 shadow-2xl shadow-purple-500/20">
                  <div className="px-6 py-4 border-b border-purple-900/50 flex items-center justify-between bg-gradient-to-r from-purple-900/20 to-pink-900/20">
                    <div className="flex items-center gap-2">
                      <span className="text-lg hacker-icon">GH</span>
                      <div className="text-sm font-semibold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">PUSH TO GITHUB</div>
                    </div>
                    <button onClick={()=>{setShowGitHubModal(false); setGithubConfig(prev => ({...prev, error: null, success: null}));}} className="text-gray-400 hover:text-gray-200">âœ•</button>
                  </div>
                  
                  <div className="px-6 py-5 space-y-4">
                    {/* GitHub Token */}
                    <div>
                      <label className="block text-xs text-gray-400 mb-1.5">GitHub Personal Access Token <span className="text-red-400">*</span></label>
                      <input 
                        type="password"
                        value={githubConfig.token}
                        onChange={(e) => setGithubConfig(prev => ({...prev, token: e.target.value}))}
                        placeholder="ghp_xxxxxxxxxxxx"
                        className="w-full px-3 py-2 rounded-lg bg-black border border-slate-700 text-gray-200 text-xs font-mono focus:border-purple-500 focus:outline-none"
                      />
                      <p className="text-[10px] text-gray-500 mt-1">
                        Create token at <a href="https://github.com/settings/tokens" target="_blank" className="text-purple-400 hover:underline">github.com/settings/tokens</a> with <code className="text-cyan-400">repo</code> scope
                      </p>
                    </div>

                    {/* Repository Name */}
                    <div>
                      <label className="block text-xs text-gray-400 mb-1.5">Repository Name <span className="text-red-400">*</span></label>
                      <input 
                        type="text"
                        value={githubConfig.repoName}
                        onChange={(e) => setGithubConfig(prev => ({...prev, repoName: e.target.value.toLowerCase().replace(/[^a-z0-9-_]/g, '-')}))}
                        placeholder="my-privacy-tool"
                        className="w-full px-3 py-2 rounded-lg bg-black border border-slate-700 text-gray-200 text-xs font-mono focus:border-purple-500 focus:outline-none"
                      />
                    </div>

                    {/* Description */}
                    <div>
                      <label className="block text-xs text-gray-400 mb-1.5">Description (optional)</label>
                      <input 
                        type="text"
                        value={githubConfig.description}
                        onChange={(e) => setGithubConfig(prev => ({...prev, description: e.target.value}))}
                        placeholder="My privacy tool built with Ghost Whistle"
                        className="w-full px-3 py-2 rounded-lg bg-black border border-slate-700 text-gray-200 text-xs focus:border-purple-500 focus:outline-none"
                      />
                    </div>

                    {/* Private Repository */}
                    <div className="flex items-center gap-2">
                      <input 
                        type="checkbox"
                        id="isPrivate"
                        checked={githubConfig.isPrivate}
                        onChange={(e) => setGithubConfig(prev => ({...prev, isPrivate: e.target.checked}))}
                        className="accent-purple-500"
                      />
                      <label htmlFor="isPrivate" className="text-xs text-gray-300 cursor-pointer">Make repository private</label>
                    </div>

                    {/* Error Message */}
                    {githubConfig.error && (
                      <div className="px-3 py-2 rounded-lg bg-red-500/10 border border-red-500/30 text-red-300 text-xs">
                        âŒ {githubConfig.error}
                      </div>
                    )}

                    {/* Success Message */}
                    {githubConfig.success && (
                      <div className="px-3 py-2 rounded-lg bg-green-500/10 border border-green-500/30 text-green-300 text-xs space-y-2">
                        <div>âœ… {githubConfig.success}</div>
                        <a href={githubConfig.repoUrl} target="_blank" className="block text-cyan-400 hover:underline font-mono break-all">
                          View Repository â†’
                        </a>
                      </div>
                    )}

                    {/* Actions */}
                    <div className="flex items-center gap-2 pt-2">
                      <button 
                        onClick={()=>{setShowGitHubModal(false); setGithubConfig(prev => ({...prev, error: null, success: null}));}} 
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 text-gray-300 transition-all"
                      >
                        Cancel
                      </button>
                      <button 
                        onClick={handlePushToGitHub}
                        disabled={githubConfig.uploading || !githubConfig.token || !githubConfig.repoName}
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-medium transition-all shadow-lg shadow-purple-500/30 disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                      >
                        {githubConfig.uploading ? (
                          <>
                            <span className="hacker-icon animate-spin">âŸ³</span>
                            <span>Uploading...</span>
                          </>
                        ) : (
                          <>
                            <span className="hacker-icon">â†‘</span>
                            <span>Push to GitHub</span>
                          </>
                        )}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* New File Modal */}
            {showNewFileModal && (
              <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                <div className="relative w-full max-w-md mx-4 rounded-2xl border border-cyan-900/50 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 shadow-2xl shadow-cyan-500/20">
                  <div className="px-6 py-4 border-b border-cyan-900/50 flex items-center justify-between bg-gradient-to-r from-cyan-900/20 to-blue-900/20">
                    <div className="text-sm font-semibold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-400">NEW FILE</div>
                    <button onClick={()=>{setShowNewFileModal(false); setNewFileName('');}} className="text-gray-400 hover:text-gray-200">âœ•</button>
                  </div>
                  
                  <div className="px-6 py-5 space-y-4">
                    <div>
                      <label className="block text-xs text-gray-400 mb-1.5">File Path <span className="text-red-400">*</span></label>
                      <input 
                        type="text"
                        value={newFileName}
                        onChange={(e) => setNewFileName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleCreateFile()}
                        placeholder="src/utils/helper.js"
                        autoFocus
                        className="w-full px-3 py-2 rounded-lg bg-black border border-slate-700 text-gray-200 text-xs font-mono focus:border-cyan-500 focus:outline-none"
                      />
                      <p className="text-[10px] text-gray-500 mt-1">
                        Include folder path and extension (e.g., <code className="text-cyan-400">api/auth.js</code>)
                      </p>
                    </div>

                    <div className="flex items-center gap-2 pt-2">
                      <button 
                        onClick={()=>{setShowNewFileModal(false); setNewFileName('');}} 
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 text-gray-300 transition-all"
                      >
                        Cancel
                      </button>
                      <button 
                        onClick={handleCreateFile}
                        disabled={!newFileName.trim()}
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-medium transition-all shadow-lg shadow-cyan-500/30 disabled:opacity-40 disabled:cursor-not-allowed"
                      >
                        Create File
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* New Folder Modal */}
            {showNewFolderModal && (
              <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                <div className="relative w-full max-w-md mx-4 rounded-2xl border border-amber-900/50 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 shadow-2xl shadow-amber-500/20">
                  <div className="px-6 py-4 border-b border-amber-900/50 flex items-center justify-between bg-gradient-to-r from-amber-900/20 to-orange-900/20">
                    <div className="text-sm font-semibold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400">NEW FOLDER</div>
                    <button onClick={()=>{setShowNewFolderModal(false); setNewFolderName('');}} className="text-gray-400 hover:text-gray-200">âœ•</button>
                  </div>
                  
                  <div className="px-6 py-5 space-y-4">
                    <div>
                      <label className="block text-xs text-gray-400 mb-1.5">Folder Path <span className="text-red-400">*</span></label>
                      <input 
                        type="text"
                        value={newFolderName}
                        onChange={(e) => setNewFolderName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleCreateFolder()}
                        placeholder="src/components"
                        autoFocus
                        className="w-full px-3 py-2 rounded-lg bg-black border border-slate-700 text-gray-200 text-xs font-mono focus:border-amber-500 focus:outline-none"
                      />
                      <p className="text-[10px] text-gray-500 mt-1">
                        Folder path without trailing slash (e.g., <code className="text-amber-400">src/utils</code>)
                      </p>
                    </div>

                    <div className="flex items-center gap-2 pt-2">
                      <button 
                        onClick={()=>{setShowNewFolderModal(false); setNewFolderName('');}} 
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 text-gray-300 transition-all"
                      >
                        Cancel
                      </button>
                      <button 
                        onClick={handleCreateFolder}
                        disabled={!newFolderName.trim()}
                        className="flex-1 px-4 py-2.5 text-xs rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white font-medium transition-all shadow-lg shadow-amber-500/30 disabled:opacity-40 disabled:cursor-not-allowed"
                      >
                        Create Folder
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

          </div>
        </div>
      );
    }

    // Render
    ReactDOM.render(<FullStackPrivacyToolsLab />, document.getElementById('root'));
  </script>
</body>
</html>

